---
output: github_document
editor_options: 
  chunk_output_type: console
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

[![Travis build status](https://travis-ci.org/r-spatialecology/onpoint.svg?branch=master)](https://travis-ci.org/r-spatialecology/onpoint)
[![AppVeyor build status](https://ci.appveyor.com/api/projects/status/4bbygdureyycu51p?svg=true)](https://ci.appveyor.com/project/mhesselbarth/onpoint)
[![codecov](https://codecov.io/gh/r-spatialecology/onpoint/branch/master/graph/badge.svg)](https://codecov.io/gh/r-spatialecology/onpoint)
[![Project Status: Active â€“ The project has reached a stable, usable state and is being actively developed.](https://www.repostatus.org/badges/latest/active.svg)](https://www.repostatus.org/#active)
[![lifecycle](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
[![License: GPL v3](https://img.shields.io/badge/License-GPLv3-blue.svg)](https://www.gnu.org/licenses/gpl-3.0)

# onpoint

`onpoint` is a growing collection of helper functions mainly related to point pattern analysis and [spatstat](http://spatstat.org/).

## Installation

You can install the development version of `onpoint` from [Github](https://github.com/r-spatialecology/onpoint) with:

```{r installation, eval = FALSE}
devtools::install_github("r-spatialecology/onpoint")
```

```{r, message = FALSE}
library(onpoint)
library(spatstat)

data(spruces)
```

### Summary functions 

Currently, `onpoint` provides two second-order summary functions, namely Besag's L-function centered to zero and the O-ring statistic. 

Centering Besag's L-function to zero has the advantage of an easier interpretation and plotting (Haase 1995). The function `center_l_function()` can either deal with a point pattern and calculated the centered L-function directly, or center the L-function afterwards it was calculating using `spatstat`s `Lest()`.

```{r}
# calculate L-function
l_function <- Lest(spruces, correction = "Ripley")

# center L-function to zero
# center_l_function <- center_l_function(l_function)
l_function_centered <- center_l_function(spruces, correction = "Ripley")
```

```{r, echo = FALSE}
plot(l_function, main = "Besag's L-function")
plot(l_function_centered, main = "centered Besag's L-function")
```

The O-ring statistic O(r) (Wiegand & Moloney 2004) can be calculated using `estimate_o_ring()`. Generally speaking, O(r) scales the pair correlation g(r) function with help of the intensity \eqn{\lambda}. One advantage of the O-ring statistic is that it can be interpreted as a neighborhood density because it is a probability density function (Wiegand & Moloney 2004).

```{r}
o_ring <- estimate_o_ring(spruces)
```

Of course, both summary functions can be used in combination with `spatstat`'s `envelope()` function.

```{r}
oring_envelope <- envelope(spruces, fun = estimate_o_ring, nsim = 199, verbose = FALSE)
```

```{r, echo = FALSE}
plot(oring_envelope, main = "O-ring statistic")
```

### Null models 

`onpoint` includes two functions to simulate null model patterns. 

`simulate_heterogenous_pattern()` is a convienent wrapper around a few `spatstat` functions to straighforward simulate a heterogeneous Poisson process.

```{r}
null_model_hetero <- simulate_heterogenous_pattern(spruces, nsim = 199)

hetero <- envelope(spruces, fun = pcf, 
                   funargs = list(correction = "Ripley", divisor = "d"),
                   simulate = null_model_hetero, nsim = 199, 
                   verbose = FALSE)
```

```{r, echo = FALSE}
plot(hetero, main = "Heterogeneous Poisson process")
```

To simulate antecedent conditions in which only one pattern influences the other, but not the other way around (Wiegand & Moloney 2004, Velazquez et al. 2016), `simulate_antecedent_conditions()` can be used. This null model randomizes only one type of points (e.g. seedlings), while keeping the other type of points constant (e.g. mature trees) to check for associations between the two.

```{r}
marks(spruces) <- ifelse(marks(spruces) > 0.3, yes = "adult", no = "seedling")

null_model_antecedent <- simulate_antecedent_conditions(spruces, 
                                                        i = "seedling", j = "adult", nsim = 199)

antecedent <- envelope(spruces, fun = pcf, 
                       funargs = list(correction = "Ripley", divisor = "d"),
                       simulate = null_model_antecedent, nsim = 199, 
                       verbose = FALSE)
```

```{r, echo = FALSE}
plot(antecedent, main = "Antecedent conditions")
```

### Various

To plot simulation envelopes using quantum plots (e.g. Esser et al. 2015), just pass an `envelope` object as input to `plot_quantums()`.

```{r}
plot_quantums(antecedent, ylab = "g(r)")
```


#### References
Besag, J. E. 1977. Discussion on Dr. Ripley's paper. - J. R. Stat. Soc. Ser. B 39: 193-195.

Esser, D. S. et al. 2015. Spatial scales of interactions among bacteria and between bacteria and the leaf surface. - FEMS Microbiol. Ecol. 91: fiu034.

Haase, P. 1995. Spatial pattern analysis in ecology based on Ripley's K-function: Introduction and methods of edge correction. - J. Veg. Sci. 6: 575-582.

Velazquez, E. et al. 2016. An evaluation of the state of spatial point pattern analysis in ecology. - Ecography (Cop.). 39: 1-14.

Wiegand, T. and Moloney, K. A. 2004. Rings, circles, and null models for point pattern analysis in ecology. - Oikos 104: 209-229.

